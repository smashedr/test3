name: "Test Cloudflare Cache Purge"

on:
  workflow_dispatch:
  release:
    types: [published]

jobs:
  test:
    name: "Test"
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: "Checkout"
        uses: actions/checkout@v3

#      - name: "Purge Cache"
#        uses: cssnr/cf-purge-cache-action@master
#        with:
#          zone: cssnr.com
#          token: ${{ secrets.CLOUDFLARE_API_TOKEN }}

      - name: "Parse Manifest"
        id: manifest
        run: |
          echo "version=$(jq '.version' < src/manifest.json)" >> "$GITHUB_OUTPUT"
          export name="$(jq '.name' < src/manifest.json | tr '[:upper:]' '[:lower:]')"
          echo "package_name=${name// /_}" >> "$GITHUB_OUTPUT"

      - name: "Debug"
        run: |
          echo github.ref: ${{ github.ref }}
          echo steps.manifest.outputs.version: ${{ steps.manifest.outputs.version }}
          echo steps.manifest.outputs.name: ${{ steps.manifest.outputs.package_name }}
